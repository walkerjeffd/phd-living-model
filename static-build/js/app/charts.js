define(["d3"],function(e){var t=function(){function T(a){a.each(function(){f.scale(u),typeof y=="string"&&(y=[y]),m=y.map(function(t){return{name:t,values:e.zip(v.map(l),v.map(function(e){return e[t]}))}}),h||(h=e.scale.category10().domain(y)),o.range([0,i-r.left-r.right]).domain(E||e.extent(v,l)),u.range([s-r.top-r.bottom,0]).domain(S||[e.min([0,e.min(m,function(t){return e.min(t.values,function(e){return e[1]})})]),e.max(m,function(t){return e.max(t.values,function(e){return e[1]})})]);var a=u.domain()[1],c=e.max(m,function(t){return e.max(t.values,function(e){return e[1]})});c>a&&u.domain([u.domain()[0],c]);if(!t){t=e.select(this).append("svg");if(w){var d=t.append("g").attr("class","legend").attr("transform","translate("+r.left+",0)"),g=d.selectAll(".legend-item").data(y);g.enter().append("g").attr("class","legend-item"),g.append("circle").attr("r",4).attr("cx",4).attr("cy",8).attr("fill",function(e){return h(e)}),g.append("text").attr("y","1em").attr("x",0).attr("dy",0).attr("dx",12).style("text-anchor","start").text(function(e){return b[e]});var x=[];g.each(function(t,n){x.push(e.select(this)[0][0].getBBox().width)});var T=[0];for(var C=1;C<x.length;C++)T.push(T[C-1]+x[C-1]);g.attr("transform",function(e,t){return t===0?null:"translate("+(T[t]+5*t)+",0)"})}var k=t.append("g").attr("transform","translate("+r.left+","+r.top+")");k.append("g").attr("class","x axis").attr("transform","translate(0,"+u.range()[0]+")"),k.append("g").attr("class","y axis").append("text").attr("y",0).attr("x",5).attr("dy",-5).style("text-anchor","start").text(p),k.append("g").attr("class","lines").attr("clip-path","url(#clip-"+n+")");var L=t.append("defs").append("clipPath").attr("id","clip-"+n).append("rect").attr("id","clip-rect").attr("x","0").attr("y","0").attr("width",i-r.left-r.right).attr("height",s-r.top-r.bottom);t.append("rect").attr("transform","translate("+r.left+","+r.top+")").attr("width",i-r.left-r.right).attr("height",s-r.top-r.bottom).attr("class","overlay")}t.attr("width",i).attr("height",s),N()})}function N(){t.select(".x.axis").call(a),t.select(".y.axis").call(f),g=t.select("g.lines").selectAll(".line").data(m),g.enter().append("path").attr("class","line"),g.attr("d",function(e){return d(e.values)}).style("stroke",function(e){return h(e.name)}),g.exit().remove()}function C(e){return o(e[0])}function k(e){return u(e[1])}var t,n=0,r={top:20,right:20,bottom:30,left:50},i=960,s=500,o=e.time.scale(),u=e.scale.linear(),a=e.svg.axis().scale(o).orient("bottom"),f=e.svg.axis().ticks(5,"g").orient("left"),l=function(e){return e[0]},c=function(e){return e[1]},h,p="",d=e.svg.line().x(C).y(k),v=[],m,g,y=[],b={},w=!0,E,S,x=e.time.format.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%b %d",function(e){return e.getDay()&&e.getDate()!=1}],["%b %d",function(e){return e.getDate()!=1}],["%b",function(e){return e.getMonth()}],["%Y",function(){return!0}]]);return a.tickFormat(x).ticks(5),T.id=function(e){return arguments.length?(n=e,T):n},T.width=function(e){return arguments.length?(i=e,T):i},T.height=function(e){return arguments.length?(s=e,T):s},T.x=function(e){return arguments.length?(l=e,T):l},T.y=function(e){return arguments.length?(c=e,T):c},T.yLabel=function(e){return arguments.length?(p=e,T):p},T.data=function(e){return arguments.length?(v=e,T):v},T.onMouseout=function(e){return arguments.length?(onMouseout=e,T):onMouseout},T.onMousemove=function(e){return arguments.length?(onMousemove=e,T):onMousemove},T.legend=function(e){return arguments.length?(w=e,T):w},T.yVariableLabels=function(e){return arguments.length?(b=e,T):b},T.yVariables=function(e){return arguments.length?(y=e,T):y},T.xDomain=function(e){return arguments.length?(E=e,T):E},T.yDomain=function(e){return arguments.length?(S=e,T):S},T.yScale=function(e){return arguments.length?(u=e,T):u},T.yAxis=function(e){return arguments.length?(f=e,T):f},T.color=function(e){return arguments.length?(h=e,T):h},T},n=function(){function E(v){v.each(function(){f.scale(u),o.range([0,i-r.left-r.right]).domain(e.extent(p,l)),u.range([s-r.top-r.bottom,0]).domain(e.extent(p,c)),b.x(o).on("brush",S);if(!t){t=e.select(this).append("svg").attr("width",i).attr("height",s);var v=t.append("g").attr("class","periods").attr("transform","translate("+r.left+",0)"),w=t.append("g").attr("transform","translate("+r.left+","+r.top+")");w.append("g").attr("class","x axis").attr("transform","translate(0,"+u.range()[0]+")"),w.append("g").attr("class","y axis").append("text").attr("y",0).attr("x",5).attr("dy",-5).style("text-anchor","start").text(h),w.append("g").attr("class","lines").attr("clip-path","url(#clip-"+n+")");var E=t.append("defs").append("clipPath").attr("id","clip-"+n).append("rect").attr("id","clip-rect").attr("x","0").attr("y","0").attr("width",i-r.left-r.right).attr("height",s-r.top-r.bottom);w.append("g").attr("class","x brush").call(b).selectAll("rect").attr("height",s-r.top-r.bottom)}g.x(function(e){return o(l(e))}).y(function(e){return u(c(e))}),y.x(function(e){return o(e)}).y(function(e,t){return 0}),t.select(".x.axis").call(a),t.select(".y.axis").call(f);var x=t.select("g.periods").selectAll(".period").data(m,function(e){return e.key});x.enter().append("path").attr("class","period line").on("click",function(e){console.log("CLICKED"),N(e.extent)}).append("title").text(function(e){return e.label}),x.attr("d",function(e){return y(e.extent)}).style("stroke",function(e){return e.color}).attr("transform",function(e,t){return"translate(0,"+(r.top-6*t-2)+")"}),x.exit().remove();var T=t.select("g.lines").selectAll(".line").data([p]);T.enter().append("path").attr("class","line").style("stroke",d),T.attr("d",g),T.exit().remove()})}function S(){v(b.extent().map(e.time.day.floor))}function x(e){return o(e[0])}function T(e){return u(e[1])}function N(e){console.log("setting brush to ",e),t.select(".brush").call(b.extent(e)),S()}var t,n=0,r={top:10,right:20,bottom:30,left:50},i=850,s=200,o=e.time.scale(),u=e.scale.linear(),a=e.svg.axis().scale(o).orient("bottom"),f=e.svg.axis().ticks(5,"g").orient("left"),l=function(e){return e[0]},c=function(e){return e[1]},h="",p,d="black",v,m=[],g=e.svg.line(),y=e.svg.line(),b=e.svg.brush(),w=e.time.format.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%b %d",function(e){return e.getDay()&&e.getDate()!=1}],["%b %d",function(e){return e.getDate()!=1}],["%b",function(e){return e.getMonth()}],["%Y",function(){return!0}]]);return a.tickFormat(w).ticks(5),E.color=function(e){return arguments.length?(d=e,E):d},E.id=function(e){return arguments.length?(n=e,E):n},E.width=function(e){return arguments.length?(i=e,E):i},E.height=function(e){return arguments.length?(s=e,E):s},E.x=function(e){return arguments.length?(l=e,E):l},E.y=function(e){return arguments.length?(c=e,E):c},E.yLabel=function(e){return arguments.length?(h=e,E):h},E.onBrush=function(e){return arguments.length?(v=e,E):v},E.data=function(e){return arguments.length?(p=e,E):p},E.periodData=function(e){return arguments.length?(m=e,E):m},E.yScale=function(e){return arguments.length?E:u},E.yAxis=function(e){return arguments.length?(f=e,E):f},E},r=function(){function E(h){h.each(function(){var h=e.extent(d,function(e){return a(e)}),p=e.extent(d,function(e){return f(e)}),E=[e.min([h[0],p[0]]),e.max([h[1],p[1]])];w?(E[0]<w[0]&&(w[0]=E[0]*.9),E[1]>w[1]&&(w[1]=E[1]*1.1)):(w=[],w[0]=E[0]*.9,w[1]=E[1]*1.1),i.range([0,n-t.left-t.right]).domain(w),s.range([r-t.top-t.bottom,0]).domain(w),y.x(function(e){return i(e[0])}).y(function(e){return s(e[1])}),o.scale(i).ticks(5,"g").orient("bottom"),u.scale(s).ticks(5,"g").orient("left");var T=e.select(this).selectAll("svg").data([d]),N=T.enter().append("svg").append("g");N.append("path").attr("class","line one2one").style("stroke","black").style("stroke-dasharray","5,5"),N.append("path").attr("class","line abline").style("stroke","blue"),N.append("g").attr("class","x axis").append("text").attr("y",0).attr("x",n-t.left-t.right).attr("dy","2.9em").style("text-anchor","end").text(l),N.append("g").attr("class","y axis").append("text").attr("y",0).attr("x",0).attr("dy",15).attr("transform","rotate(-90)").style("text-anchor","end").text(c),N.append("g").attr("class","circles"),T.attr("width",n).attr("height",r);var C=T.select("g").attr("transform","translate("+t.left+","+t.top+")");C.select(".x.axis").attr("transform","translate(0,"+s.range()[0]+")").call(o),C.select(".y.axis").call(u);var k=C.select(".circles").selectAll(".circle").data(d,function(e){return e.Date});k.enter().append("circle").attr("class","circle").attr("r",v),k.attr("cx",S).attr("cy",x).attr("opacity",m),k.exit().remove(),g?C.select(".line.one2one").attr("d",y([[i.domain()[0],s.domain()[0]],[i.domain()[1],s.domain()[1]]])):C.select(".line.one2one").remove(),b?C.select(".line.abline").attr("d",y([[i.domain()[0],Math.exp(b[0])*Math.pow(i.domain()[0],b[1])],[i.domain()[1],Math.exp(b[0])*Math.pow(i.domain()[1],b[1])]])):C.select(".line.abline").attr("d",y([[i.domain()[0],i.domain()[0]],[i.domain()[0],i.domain()[0]]]))})}function S(e){return i(a(e))}function x(e){return s(f(e))}var t={top:20,right:20,bottom:40,left:50},n=960,r=500,i=e.scale.linear(),s=e.scale.linear(),o=e.svg.axis(),u=e.svg.axis(),a=function(e){return e[0]},f=function(e){return e[1]},l="",c="",h,p,d=[],v,m=1,g=!1,y=e.svg.line(),b,w;return E.width=function(e){return arguments.length?(n=e,E):n},E.height=function(e){return arguments.length?(r=e,E):r},E.x=function(e){return arguments.length?(a=e,E):a},E.y=function(e){return arguments.length?(f=e,E):f},E.xScale=function(e){return arguments.length?(i=e,E):i},E.yScale=function(e){return arguments.length?(s=e,E):s},E.xLabel=function(e){return arguments.length?(l=e,E):l},E.yLabel=function(e){return arguments.length?(c=e,E):c},E.xDomain=function(e){return arguments.length?(h=e,E):h},E.yDomain=function(e){return arguments.length?(p=e,E):p},E.data=function(e){return arguments.length?(d=e,E):d},E.r=function(e){return arguments.length?(v=e,E):v},E.opacity=function(e){return arguments.length?(m=e,E):m},E.one2one=function(e){return arguments.length?(g=e,E):g},E.abline=function(e){return arguments.length?(b=e,E):b},E};return{TimeseriesChart:t,BrushChart:n,ScatterChart:r}});