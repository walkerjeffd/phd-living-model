define(["jquery","underscore","backbone","d3","app/charts","app/utils"],function(e,t,n,r,i,s){var o=n.View.extend({template:t.template(e("#template-summary").html()),initialize:function(e){console.log("SummaryView: initialize"),this.simModel=e.simModel,this.dateFormat=r.time.format("%Y-%m-%d"),this.statFormat=r.format("4.4f"),this.percentFormat=r.format(".2p"),this.listenTo(this.model,"updateInput",this.renderTable),this.listenTo(this.model,"setExtent",this.renderTable),this.listenTo(this.model,"change:cal_start",this.renderTable),this.listenTo(this.model,"change:cal_end",this.renderTable),this.listenTo(this.model,"recompute",this.renderTable),this.render()},renderExtent:function(e){},renderTable:function(){var e=r.time.format("%Y-%m-%d"),n=r.time.format("%Y-%m-%dT%H:%M:%S"),i=this.model.extent;if(this.model.get("cal_start")&&this.model.get("cal_end")){var o=n.parse(this.model.get("cal_start")),u=n.parse(this.model.get("cal_end")),a=t.filter(this.simModel.output,function(e){return e.Date>=o&&e.Date<=u}),f=s.statsGOF(a,"obsQ","Q");this.$("#calib-start").text(this.dateFormat(o)),this.$("#calib-end").text(this.dateFormat(u)),this.$("#calib-count").text(Math.round((u-o)/864e5)+1),this.$("#calib-rmse").text(this.statFormat(f.rmse)),this.$("#calib-bias").text(this.percentFormat(f.perBias))}if(i){i=i.map(e.parse);var l=t.filter(this.simModel.output,function(e){return e.Date>=i[0]&&e.Date<=i[1]}),c=s.statsGOF(l,"obsQ","Q");this.$("#extent-start").text(this.dateFormat(i[0])),this.$("#extent-end").text(this.dateFormat(i[1])),this.$("#extent-count").text(Math.round((i[1]-i[0])/864e5)+1),this.$("#extent-rmse").text(this.statFormat(c.rmse)),this.$("#extent-bias").text(this.percentFormat(c.perBias))}else this.$("#extent-start").text(""),this.$("#extent-end").text(""),this.$("#extent-count").text(""),this.$("#extent-rmse").text(""),this.$("#extent-bias").text("");if(this.model.input&&this.model.input.length>0){var h=s.statsGOF(this.simModel.output,"obsQ","Q");this.$("#dataset-start").text(this.dateFormat(this.model.input[0].Date)),this.$("#dataset-end").text(this.dateFormat(this.model.input[this.model.input.length-1].Date)),this.$("#dataset-count").text(this.model.input.length),this.$("#dataset-rmse").text(this.statFormat(h.rmse)),this.$("#dataset-bias").text(this.percentFormat(h.perBias))}},render:function(){return console.log("SummaryView: render"),this.$el.html(this.template()),this}});return o});