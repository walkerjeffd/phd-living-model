define(["jquery","underscore","backbone","d3","app/charts","app/utils"],function(e,t,n,r,i,s){var o=n.View.extend({template:t.template(e("#template-info").html()),events:{"click #btn-save":"saveModel","click #btn-reset":"resetModel","click #btn-dl-input":"downloadInput","click #btn-dl-output":"downloadOutput"},initialize:function(e){console.log("InfoView: initialize"),this.simModel=e.simModel,this.listenTo(this.model,"sync",this.render)},downloadInput:function(){if(this.model.input&&this.model.input.length>0){var e=r.time.format("%Y-%m-%d"),t=this.model.input.map(function(t){return{Date:e(t.Date),Tmin_degC:t.Tmin_degC,Tmax_degC:t.Tmax_degC,Precip_in:t.Precip_in,Flow_in:t.Flow_in}});s.saveToCSVFile(t,"input.csv")}},downloadOutput:function(){if(this.simModel&&this.simModel.output&&this.simModel.output.length>0){var e=r.time.format("%Y-%m-%d"),t=this.simModel.output.map(function(t){return{Date:e(t.Date),Tmin_degC:t.Tmin,Tmax_degC:t.Tmax,Precip_in:t.P,Obs_Flow_in:t.obsQ,Tavg_degC:t.Tavg,Trng_degC:t.Trng,JulianDay:t.Jday,Solar_in:t.SR,PET_in:t.PET,AvailableWater_in:t.W,ETOpportunity_in:t.Y,SoilMoisture_in:t.S,ET_in:t.ET,Runoff_in:t.DR,GWRecharge_in:t.GR,Groundwater_in:t.G,GWDischarge_in:t.GD,Flow_in:t.Q}});s.saveToCSVFile(t,"output.csv")}},saveModel:function(){var e=r.time.format("%Y-%m-%dT%H:%M:%S"),t=e(this.model.input[0].Date),n=e(this.model.input[this.model.input.length-1].Date),i,s;this.model.extent?(i=this.model.extent[0]+"T00:00:00",s=this.model.extent[1]+"T00:00:00"):(i=t,s=n),this.model.set("cal_start",i),this.model.set("cal_end",s),this.model.set("last_start",t),this.model.set("last_end",n),this.model.set("updated",e(new Date)),this.model.save({},{success:function(e,t,n){console.log("Model Save Success",t),this.model.trigger("flashStatus","Model saved")}.bind(this),error:function(e,t,n){console.log("Model Save Failed",t),this.model.trigger("flashStatus","Model save failed. See console (F12)")}.bind(this)})},resetModel:function(){this.model.fetch({success:function(e,t,n){this.model.trigger("changeParam"),console.log("Model Reset Success",t),this.model.trigger("flashStatus","Model reset")}.bind(this),error:function(e,t,n){console.log("Model Reset Failed",t),this.model.trigger("flashStatus","Model reset failed. See console (F12)")}.bind(this)})},render:function(){return console.log("InfoView: render"),this.$el.html(this.template(this.model.attributes)),this}});return o});